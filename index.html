<!DOCTYPE html>
<html lang="ur" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>سائنس کی دنیا</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&display=swap" rel="stylesheet">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["'Noto Nastaliq Urdu'", 'serif'],
            },
          },
        },
      }
    </script>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "@google/genai": "https://esm.sh/@google/genai"
  }
}
</script>
</head>
  <body class="bg-blue-50">
    <div id="root"></div>
    <script type="module">
      import React, { useState, useCallback, useEffect } from 'react';
      import ReactDOM from 'react-dom/client';
      import { GoogleGenAI, Type, Modality } from "@google/genai";

      // --- START OF INLINED CODE ---

      // constants.ts
      const SCIENCE_TOPICS = [
        'جانداروں کی درجہ بندی', // Unit 1: Classification of Living Things
        'خردبینی جاندار',       // Unit 2: Microorganisms
        'ماحولیاتی آلودگی',      // Unit 3: Environmental Pollution
        'مادہ اور اس کی حالتیں', // Unit 4: Matter and its States
        'قوتیں اور مشینیں',      // Unit 5: Forces and Machines
        'روشنی کی خصوصیات',     // Unit 6: Properties of Light
        'بجلی اور مقناطیسیت',   // Unit 7: Electricity and Magnetism
        'نظام شمسی',             // Unit 8: Solar System
      ];

      // services/geminiService.ts
      const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });

      const resultSchema = {
        type: Type.OBJECT,
        properties: {
          title: { type: Type.STRING, description: 'The main topic title in Urdu.' },
          explanation: { type: Type.STRING, description: 'A detailed explanation of the topic in simple Urdu, suitable for a 5th-grade student. It should be at least 100 words.' },
          imagePrompt: { type: Type.STRING, description: 'A simple, clear English prompt for an AI image generator to create a relevant, simple, and visually appealing image to illustrate the topic. For example: "simple diagram of solar system for kids".' },
          subTopics: { type: Type.ARRAY, description: 'A list of 3-4 related sub-topics in Urdu that the student can explore next.', items: { type: Type.STRING } }
        },
        required: ['title', 'explanation', 'imagePrompt', 'subTopics']
      };

      const quizSchema = {
        type: Type.OBJECT,
        properties: {
          mcqs: {
            type: Type.ARRAY, description: "A list of 4-5 multiple-choice questions in Urdu. At least one should have an image prompt.",
            items: {
              type: Type.OBJECT,
              properties: {
                question: { type: Type.STRING, description: "The quiz question in Urdu." },
                options: { type: Type.ARRAY, items: { type: Type.STRING }, description: "An array of 4 possible answers in Urdu." },
                correctAnswer: { type: Type.STRING, description: "The correct answer from the options list." },
                imagePrompt: { type: Type.STRING, description: "Optional. A simple, clear English prompt for an image to illustrate this question. E.g., 'A simple diagram of photosynthesis'." }
              }, required: ["question", "options", "correctAnswer"]
            }
          },
          fillInTheBlanks: {
            type: Type.ARRAY, description: "A list of 2-3 fill-in-the-blanks questions in Urdu where the user types the answer.",
            items: {
              type: Type.OBJECT,
              properties: {
                question: { type: Type.STRING, description: "The question sentence in Urdu with a blank represented by '____'." },
                correctAnswer: { type: Type.STRING, description: "The correct word for the blank." }
              }, required: ["question", "correctAnswer"]
            }
          },
          shortAnswerQuestions: {
            type: Type.ARRAY, description: "A list of 2 short-answer questions in Urdu.",
            items: {
              type: Type.OBJECT,
              properties: {
                question: { type: Type.STRING, description: "The short answer question." },
                correctAnswer: { type: Type.STRING, description: "A model correct answer." }
              }, required: ["question", "correctAnswer"]
            }
          },
          diagramLabeling: {
            type: Type.ARRAY, description: "A list of 1 diagram labeling question. The diagram should have numbered parts to label.",
            items: {
              type: Type.OBJECT,
              properties: {
                prompt: { type: Type.STRING, description: "Instruction in Urdu, e.g., 'نیچے دی گئی تصویر کے حصوں کو درست ناموں سے لیبل کریں'." },
                imagePrompt: { type: Type.STRING, description: "A simple English prompt to generate a diagram with numbered blank labels. E.g., 'A simple diagram of a flower with 4 numbered parts (petal, sepal, stamen, pistil) for labeling'." },
                labels: { type: Type.ARRAY, items: { type: Type.STRING }, description: "The list of labels in Urdu." },
                correctMatches: {
                  type: Type.ARRAY, description: "An array of objects mapping the Urdu label to the corresponding number on the diagram. e.g., [{label: 'پھول کی پتی', number: '1'}]",
                  items: { type: Type.OBJECT, properties: { label: { type: Type.STRING }, number: { type: Type.STRING } }, required: ["label", "number"] }
                }
              }, required: ["prompt", "imagePrompt", "labels", "correctMatches"]
            }
          },
          tableCompletion: {
            type: Type.ARRAY, description: "A list of 1 table completion question designed for drag-and-drop.",
            items: {
              type: Type.OBJECT,
              properties: {
                prompt: { type: Type.STRING, description: "Instruction in Urdu, e.g., 'نیچے دیے گئے جدول کو مکمل کریں'." },
                headers: { type: Type.ARRAY, items: { type: Type.STRING }, description: "Table headers in Urdu." },
                rows: { type: Type.ARRAY, items: { type: Type.ARRAY, items: { type: Type.STRING, nullable: true } }, description: "Table rows, with null for empty cells students need to fill." },
                wordBank: { type: Type.ARRAY, items: { type: Type.STRING }, description: "A list of words in Urdu that can be dragged into the empty cells." },
                correctAnswers: {
                  type: Type.ARRAY, description: "An array of objects mapping the 'rowIndex-colIndex' key to the correct Urdu answer.",
                  items: { type: Type.OBJECT, properties: { key: { type: Type.STRING }, answer: { type: Type.STRING } }, required: ["key", "answer"] }
                }
              }, required: ["prompt", "headers", "rows", "wordBank", "correctAnswers"]
            }
          }
        }
      };

      const generateImageFromPrompt = async (prompt) => {
        try {
          const response = await ai.models.generateContent({ model: 'gemini-2.5-flash-image', contents: { parts: [{ text: prompt }] }, config: { responseModalities: [Modality.IMAGE] } });
          for (const part of response.candidates[0].content.parts) {
            if (part.inlineData) { return `data:image/png;base64,${part.inlineData.data}`; }
          }
          throw new Error("No image data found in response.");
        } catch (error) {
          console.error("Image generation failed:", prompt, error);
          return 'https://via.placeholder.com/400x225.png?text=Image+Failed+to+Load';
        }
      };

      async function generateScienceExplanation(topic) {
        const response = await ai.models.generateContent({ model: 'gemini-2.5-flash', contents: `پانچویں جماعت کے طالب علم کے لیے اس سائنس کے موضوع کی وضاحت کریں: "${topic}".`, config: { responseMimeType: 'application/json', responseSchema: resultSchema, systemInstruction: 'You are an expert science teacher for 5th-grade students in Pakistan. Your responses should be in simple, clear Urdu.' } });
        const parsedResult = JSON.parse(response.text.trim());
        const generatedImageUrl = await generateImageFromPrompt(parsedResult.imagePrompt);
        delete parsedResult.imagePrompt;
        return { ...parsedResult, imageUrl: generatedImageUrl };
      }

      async function generateContentFromPage(base64Image, mimeType) {
        const imagePart = { inlineData: { data: base64Image, mimeType: mimeType } };
        const textPart = { text: 'یہ ایک کتاب کا صفحہ ہے. اس صفحہ کا مرکزی موضوع کیا ہے؟ اس موضوع کو پانچویں جماعت کے طالب علم کے لیے سادہ اردو میں بیان کریں۔' };
        const response = await ai.models.generateContent({ model: 'gemini-2.5-flash', contents: { parts: [imagePart, textPart] }, config: { responseMimeType: 'application/json', responseSchema: resultSchema, systemInstruction: 'You are an expert science teacher for 5th-grade students in Pakistan. Analyze the textbook page image and explain the main topic in simple, clear Urdu.' } });
        const parsedResult = JSON.parse(response.text.trim());
        const generatedImageUrl = await generateImageFromPrompt(parsedResult.imagePrompt);
        delete parsedResult.imagePrompt;
        return { ...parsedResult, imageUrl: generatedImageUrl };
      }

      async function generateQuiz(topic) {
        const response = await ai.models.generateContent({ model: 'gemini-2.5-flash', contents: `اس موضوع پر پانچویں جماعت کے طالب علم کے لیے ایک متنوع کوئز بنائیں: "${topic}".`, config: { responseMimeType: 'application/json', responseSchema: quizSchema, systemInstruction: 'You are a quiz generator for 5th-grade science students in Pakistan. Create diverse questions in Urdu as per the schema.' } });
        const quizStructure = JSON.parse(response.text.trim());
        if (quizStructure.mcqs) {
          await Promise.all(quizStructure.mcqs.map(async (mcq) => { if (mcq.imagePrompt) { mcq.imageUrl = await generateImageFromPrompt(mcq.imagePrompt); delete mcq.imagePrompt; } }));
        }
        if (quizStructure.diagramLabeling) {
          await Promise.all(quizStructure.diagramLabeling.map(async (diag) => { if (diag.imagePrompt) { diag.imageUrl = await generateImageFromPrompt(diag.imagePrompt); delete diag.imagePrompt; } }));
        }
        return quizStructure;
      }

      // components/Header.tsx
      const Header = ({ onSearch }) => {
          const [searchTerm, setSearchTerm] = React.useState('');

          const handleSearchSubmit = (e) => {
              e.preventDefault();
              if (searchTerm.trim()) {
                  onSearch(searchTerm.trim());
              }
          };

          return React.createElement("header", { className: "relative p-6 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-2xl shadow-xl" },
              React.createElement("div", { className: "text-center" },
                  React.createElement("h1", { className: "text-4xl sm:text-5xl font-bold text-white tracking-wide" }, "سائنس کی دنیا"),
                  React.createElement("p", { className: "text-white/90 text-lg sm:text-xl mt-6" }, "پانچویں جماعت کے طلباء کے لیے")
              ),
              React.createElement("form", { onSubmit: handleSearchSubmit, className: "absolute top-4 right-4 sm:top-6 sm:right-6" },
                  React.createElement("div", { className: "flex flex-row-reverse" },
                      React.createElement("input", {
                          type: "text",
                          placeholder: "تلاش کریں...",
                          value: searchTerm,
                          onChange: (e) => setSearchTerm(e.target.value),
                          className: "px-3 py-1.5 text-base text-gray-800 bg-white/90 rounded-l-full focus:outline-none focus:ring-2 focus:ring-cyan-300 w-36 sm:w-48 transition-all duration-300"
                      }),
                      React.createElement("button", {
                          type: "submit",
                          className: "px-3 py-1.5 text-white bg-blue-700 rounded-r-full hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-400"
                      },
                          React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-5 w-5", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
                              React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" })
                          )
                      )
                  )
              )
          );
      };

      // components/TopicSelector.tsx
      const TopicSelector = ({ topics, selectedTopic, onSelect }) => (
        React.createElement("div", { className: "flex flex-wrap justify-center gap-3 sm:gap-4" },
          topics.map((topic) =>
            React.createElement("button", {
              key: topic,
              onClick: () => onSelect(topic),
              className: `px-6 py-3 text-lg font-bold rounded-full transition-all duration-300 ease-in-out transform hover:scale-105 shadow-md focus:outline-none focus:ring-4 focus:ring-opacity-50 ${selectedTopic === topic ? 'bg-cyan-600 text-white ring-cyan-400' : 'bg-white text-cyan-700 hover:bg-cyan-100 ring-cyan-200'}`
            }, topic)
          )
        )
      );

      // components/PageUploader.tsx
      const PageUploader = ({ onConvert, loading }) => {
        const [selectedFile, setSelectedFile] = useState(null);
        const [previewUrl, setPreviewUrl] = useState(null);

        const handleFileChange = (event) => {
          const file = event.target.files?.[0];
          if (file) {
            setSelectedFile(file);
            const reader = new FileReader();
            reader.onloadend = () => setPreviewUrl(reader.result);
            reader.readAsDataURL(file);
          }
        };

        const handleConvertClick = useCallback(() => {
          if (selectedFile) onConvert(selectedFile);
        }, [selectedFile, onConvert]);

        return React.createElement("div", { className: "flex flex-col items-center gap-6 p-6 border-2 border-dashed border-cyan-400 rounded-2xl bg-white/80 backdrop-blur-sm shadow-lg" },
          React.createElement("h3", { className: "text-xl font-bold text-cyan-800 text-center" }, "یا اپنی کتاب سے ایک صفحہ اپ لوڈ کریں"),
          React.createElement("div", { className: "w-full max-w-md" },
            React.createElement("label", { htmlFor: "page-upload", className: "w-full inline-block px-6 py-3 text-lg font-semibold text-center text-cyan-700 bg-white rounded-full shadow-md cursor-pointer hover:bg-cyan-100 transition-colors" }, selectedFile ? 'دوسری تصویر منتخب کریں' : 'تصویر منتخب کریں'),
            React.createElement("input", { id: "page-upload", type: "file", accept: "image/*", onChange: handleFileChange, className: "hidden", disabled: loading })
          ),
          previewUrl && React.createElement("div", { className: "mt-4 w-full max-w-sm border-4 border-white rounded-xl shadow-lg" },
            React.createElement("p", { className: "text-center text-gray-600 mb-2" }, "منتخب صفحہ:"),
            React.createElement("img", { src: previewUrl, alt: "Selected page preview", className: "w-full h-auto rounded-lg" })
          ),
          React.createElement("button", { onClick: handleConvertClick, disabled: loading || !selectedFile, className: "px-8 py-4 text-xl font-bold text-white bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed disabled:scale-100" }, loading ? '...تبدیل کیا جا رہا ہے' : 'اس صفحہ کو سبق میں تبدیل کریں')
        );
      };

      // components/LoadingSpinner.tsx
      const LoadingSpinner = () => (
        React.createElement("div", { className: "flex justify-center items-center" },
          React.createElement("div", { className: "w-16 h-16 border-8 border-t-8 border-t-cyan-500 border-gray-200 rounded-full animate-spin" })
        )
      );

      // components/ResultDisplay.tsx
      const ResultDisplay = ({ loading, error, result, onSubTopicClick, onStartQuiz, quizLoading }) => {
        if (loading) return React.createElement("div", { className: "mt-8 text-center bg-white/70 backdrop-blur-sm p-8 rounded-2xl shadow-lg" }, React.createElement(LoadingSpinner), React.createElement("p", { className: "text-xl text-cyan-800 mt-4" }, "براہ کرم انتظار کریں..."));
        if (error) return React.createElement("div", { className: "mt-8 text-center bg-red-100 p-8 rounded-2xl shadow-lg border border-red-300" }, React.createElement("p", { className: "text-xl text-red-700 font-bold" }, error));
        if (!result) return null;

        return React.createElement("div", { className: "mt-8 bg-white/90 backdrop-blur-sm rounded-2xl shadow-2xl overflow-hidden" },
          React.createElement("div", { className: "p-6 sm:p-10" },
            React.createElement("h3", { className: "text-3xl font-bold text-blue-800 mb-6 text-center" }, result.title),
            React.createElement("div", { className: "mb-8" }, React.createElement("img", { src: result.imageUrl, alt: "Generated visual", className: "w-full h-auto object-cover rounded-xl shadow-lg border-4 border-white" })),
            React.createElement("div", { className: "text-right text-gray-800" }, React.createElement("p", { className: "text-2xl whitespace-pre-wrap leading-relaxed sm:leading-loose" }, result.explanation)),
            result.subTopics?.length > 0 && React.createElement("div", { className: "mt-10 pt-6 border-t-2 border-cyan-200" },
              React.createElement("h4", { className: "text-2xl font-bold text-cyan-800 mb-4 text-center" }, "مزید دریافت کریں"),
              React.createElement("div", { className: "flex flex-wrap justify-center gap-3 sm:gap-4" }, result.subTopics.map(subTopic => React.createElement("button", { key: subTopic, onClick: () => onSubTopicClick(subTopic), className: "px-6 py-3 text-lg font-bold rounded-full transition-all duration-300 ease-in-out transform hover:scale-105 shadow-md focus:outline-none focus:ring-4 focus:ring-opacity-50 bg-white text-cyan-700 hover:bg-cyan-100 ring-cyan-200" }, subTopic)))
            ),
            React.createElement("div", { className: "mt-10 pt-6 border-t-2 border-cyan-200 text-center" },
              React.createElement("button", { onClick: () => onStartQuiz(result.title), disabled: quizLoading, className: "px-8 py-4 text-xl font-bold text-white bg-gradient-to-r from-blue-600 to-cyan-600 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed disabled:scale-100" }, quizLoading ? '...ٹیسٹ تیار کیا جا رہا ہے' : 'اس سبق کا ٹیسٹ دیں')
            )
          )
        );
      };

      // components/QuizView.tsx
      const QuizView = ({ quiz, topic, showAnswers, onShowAnswersClick, onExitQuizClick }) => {
        const [userAnswers, setUserAnswers] = useState({ mcqs: {}, fillInTheBlanks: {}, shortAnswerQuestions: {}, diagramLabeling: {}, tableCompletion: {} });
        useEffect(() => {
          const initialDiagramAnswers = {};
          quiz.diagramLabeling?.forEach(q => { q?.correctMatches?.forEach(match => { if (match?.number) { initialDiagramAnswers[match.number] = null; } }); });
          setUserAnswers(prev => ({ ...prev, mcqs: {}, fillInTheBlanks: {}, shortAnswerQuestions: {}, tableCompletion: {}, diagramLabeling: initialDiagramAnswers }));
        }, [quiz]);

        const handleMcqSelect = (qIndex, option) => setUserAnswers(prev => ({ ...prev, mcqs: { ...prev.mcqs, [qIndex]: option } }));
        const handleFillInTheBlanksChange = (qIndex, value) => setUserAnswers(prev => ({ ...prev, fillInTheBlanks: { ...prev.fillInTheBlanks, [qIndex]: value } }));
        const handleShortAnswerChange = (qIndex, value) => setUserAnswers(prev => ({ ...prev, shortAnswerQuestions: { ...prev.shortAnswerQuestions, [qIndex]: value } }));
        const handleTableDrop = (event, qIndex, rIndex, cIndex) => {
          event.preventDefault();
          const draggedWord = event.dataTransfer.getData('text/plain');
          if (draggedWord && !showAnswers) {
            const newAnswers = { ...userAnswers.tableCompletion };
            const sourceKey = Object.keys(newAnswers).find(key => newAnswers[key] === draggedWord);
            if (sourceKey) delete newAnswers[sourceKey];
            newAnswers[`${qIndex}-${rIndex}-${cIndex}`] = draggedWord;
            setUserAnswers(prev => ({ ...prev, tableCompletion: newAnswers }));
          }
        };
        const handleDragStart = (event, label) => { if (!showAnswers) event.dataTransfer.setData('text/plain', label); };
        const handleDrop = (event, targetNumber) => {
          event.preventDefault();
          const draggedLabel = event.dataTransfer.getData('text/plain');
          if (draggedLabel && !showAnswers) {
            const newAnswers = { ...userAnswers.diagramLabeling };
            Object.keys(newAnswers).forEach(key => { if (newAnswers[key] === draggedLabel) newAnswers[key] = null; });
            newAnswers[targetNumber] = draggedLabel;
            setUserAnswers(prev => ({ ...prev, diagramLabeling: newAnswers }));
          }
        };

        const renderMCQs = (mcqs) => (mcqs && React.createElement("div", { key: "mcqs", className: "space-y-8" }, React.createElement("h3", { className: "text-2xl font-bold text-cyan-800 border-b-2 pb-2" }, "کثیر الانتخابی سوالات"), mcqs.map((q, index) => React.createElement("div", { key: index, className: "p-6 border border-gray-200 rounded-xl bg-white/50" }, React.createElement("p", { className: "text-xl font-semibold text-gray-800 mb-4 text-right" }, `${index + 1}. ${q.question}`), q.imageUrl && React.createElement("img", { src: q.imageUrl, alt: "Question visual", className: "my-4 rounded-lg shadow-sm mx-auto max-h-60" }), React.createElement("div", { className: "grid grid-cols-1 sm:grid-cols-2 gap-3" }, q.options.map(option => { let className = 'bg-white hover:bg-gray-100'; const isSelected = userAnswers.mcqs[index] === option; if (showAnswers) { const isCorrect = option === q.correctAnswer; if (isCorrect) className = 'bg-green-200'; else if (isSelected && !isCorrect) className = 'bg-red-200'; else className = 'bg-white opacity-60'; } else if (isSelected) { className = 'bg-cyan-200'; } return React.createElement("button", { key: option, onClick: () => handleMcqSelect(index, option), disabled: showAnswers, className: `w-full p-4 text-right text-lg rounded-lg border-2 transition-all duration-200 ${className} ${!showAnswers ? 'cursor-pointer' : 'cursor-default'}` }, option); })), showAnswers && React.createElement("div", { className: "mt-4 p-3 bg-green-100 text-green-800 font-bold rounded-lg text-right" }, `صحیح جواب: ${q.correctAnswer}`)))));
        const renderFillInTheBlanks = (questions) => (questions && React.createElement("div", { key: "fillBlanks", className: "space-y-8" }, React.createElement("h3", { className: "text-2xl font-bold text-cyan-800 border-b-2 pb-2" }, "خالی جگہ پر کریں"), questions.map((q, index) => { const userAnswer = userAnswers.fillInTheBlanks[index] || ''; let inputClass = 'border-gray-300'; if (showAnswers) { inputClass = userAnswer.trim() === q.correctAnswer ? 'border-green-500 bg-green-100' : 'border-red-500 bg-red-100'; } return React.createElement("div", { key: index, className: "p-6 border border-gray-200 rounded-xl bg-white/50 text-right" }, React.createElement("div", { className: "text-xl flex flex-wrap items-center justify-end gap-2" }, React.createElement("span", null, q.question.split('____')[0]), React.createElement("input", { type: "text", value: userAnswer, disabled: showAnswers, onChange: (e) => handleFillInTheBlanksChange(index, e.target.value), className: `inline-block w-48 text-center p-1 text-xl border-2 rounded-md ${inputClass}` }), React.createElement("span", null, q.question.split('____')[1])), showAnswers && React.createElement("div", { className: "mt-4 p-3 bg-green-100 text-green-800 font-bold rounded-lg" }, `صحیح جواب: ${q.correctAnswer}`)); })));
        const renderShortAnswerQuestions = (questions) => (questions && React.createElement("div", { key: "shortAnswers", className: "space-y-8" }, React.createElement("h3", { className: "text-2xl font-bold text-cyan-800 border-b-2 pb-2" }, "مختصر سوالات"), questions.map((q, index) => React.createElement("div", { key: index, className: "p-6 border border-gray-200 rounded-xl bg-white/50 text-right" }, React.createElement("p", { className: "text-xl font-semibold text-gray-800 mb-4" }, `${index + 1}. ${q.question}`), React.createElement("textarea", { value: userAnswers.shortAnswerQuestions[index] || '', disabled: showAnswers, onChange: (e) => handleShortAnswerChange(index, e.target.value), rows: 3, className: "w-full p-2 text-lg border-2 border-gray-300 rounded-lg disabled:bg-gray-100" }), showAnswers && React.createElement("div", { className: "mt-4 p-3 bg-green-100 text-green-800 font-bold rounded-lg text-right" }, `مثالی جواب: ${q.correctAnswer}`)))));
        const renderDiagramLabeling = (diagrams) => (diagrams && React.createElement("div", { key: "diagrams", className: "space-y-8" }, React.createElement("h3", { className: "text-2xl font-bold text-cyan-800 border-b-2 pb-2" }, "ڈایاگرام لیبل کریں"), diagrams.map((q, index) => React.createElement("div", { key: index, className: "p-6 border border-gray-200 rounded-xl bg-white/50" }, React.createElement("p", { className: "text-xl font-semibold text-gray-800 mb-4 text-center" }, q.prompt), React.createElement("div", { className: "flex flex-col md:flex-row gap-8 items-center" }, React.createElement("div", { className: "flex-grow flex justify-center" }, React.createElement("img", { src: q.imageUrl, alt: "Diagram", className: "max-w-full md:max-w-md rounded-lg" })), React.createElement("div", { className: "w-full md:w-64 space-y-3" }, React.createElement("p", { className: "font-bold text-center" }, "لیبلز"), React.createElement("div", { className: "flex flex-wrap justify-center gap-2 mb-4" }, q.labels.map(label => React.createElement("div", { key: label, draggable: true, onDragStart: (e) => handleDragStart(e, label), className: `px-3 py-2 rounded-md shadow-sm ${!showAnswers ? 'cursor-grab' : ''} ${Object.values(userAnswers.diagramLabeling).includes(label) ? 'opacity-40' : 'bg-cyan-100'}` }, label))), React.createElement("div", { className: "space-y-2" }, q.correctMatches.map(({ number: num }) => { const userAnswer = userAnswers.diagramLabeling[num]; const correctAnswer = q.correctMatches.find(m => m.number === num)?.label; let className = 'bg-gray-100'; if (showAnswers) className = userAnswer === correctAnswer ? 'bg-green-200' : 'bg-red-200'; return React.createElement("div", { key: num, className: "flex items-center gap-2" }, React.createElement("span", { className: "font-bold" }, `${num}.`), React.createElement("div", { onDragOver: (e) => e.preventDefault(), onDrop: (e) => handleDrop(e, num), className: `w-full h-12 flex justify-center items-center rounded-lg border-2 border-dashed ${className}` }, userAnswer || 'یہاں ڈراپ کریں')); })))), showAnswers && React.createElement("div", { className: "mt-4 p-3 bg-green-100 text-green-800 font-bold rounded-lg text-right" }, React.createElement("p", null, "صحیح جوابات:"), React.createElement("ul", { className: "list-disc list-inside" }, q.correctMatches.map(({ label, number: num }) => React.createElement("li", { key: num }, `${num} - ${label}`))))))));
        const renderTableCompletion = (tables) => (tables && React.createElement("div", { key: "tables", className: "space-y-8" }, React.createElement("h3", { className: "text-2xl font-bold text-cyan-800 border-b-2 pb-2" }, "جدول مکمل کریں"), tables.map((q, qIndex) => React.createElement("div", { key: qIndex, className: "p-6 border border-gray-200 rounded-xl bg-white/50 overflow-x-auto" }, React.createElement("p", { className: "text-xl font-semibold text-gray-800 mb-4 text-center" }, q.prompt), React.createElement("div", { className: "mb-4 flex flex-wrap justify-center gap-2 p-3 bg-cyan-50 rounded-lg" }, React.createElement("p", { className: "font-bold w-full text-center mb-2" }, "الفاظ کا بینک:"), q.wordBank.map(word => React.createElement("div", { key: word, draggable: true, onDragStart: (e) => handleDragStart(e, word), className: `px-3 py-2 rounded-md shadow-sm ${!showAnswers ? 'cursor-grab' : ''} ${Object.values(userAnswers.tableCompletion).includes(word) ? 'opacity-40' : 'bg-white'}` }, word))), React.createElement("table", { className: "w-full border-collapse text-center" }, React.createElement("thead", null, React.createElement("tr", null, q.headers.map(h => React.createElement("th", { key: h, className: "border p-2 bg-cyan-100" }, h)))), React.createElement("tbody", null, q.rows.map((row, rIndex) => React.createElement("tr", { key: rIndex }, row.map((cell, cIndex) => { if (cell !== null && cell.trim() !== 'مقررہ') return React.createElement("td", { key: cIndex, className: "border p-2 align-middle" }, cell); const key = `${qIndex}-${rIndex}-${cIndex}`; const userAnswer = userAnswers.tableCompletion[key] || null; const correctAnswer = q.correctAnswers.find(a => a.key === `${rIndex}-${cIndex}`)?.answer || ''; let dropZoneClass = 'bg-gray-100'; if (showAnswers) dropZoneClass = userAnswer === correctAnswer ? 'bg-green-200' : 'bg-red-200'; return React.createElement("td", { key: cIndex, className: "border p-1 align-middle", onDragOver: (e) => e.preventDefault(), onDrop: (e) => handleTableDrop(e, qIndex, rIndex, cIndex) }, React.createElement("div", { className: `w-full h-12 flex justify-center items-center rounded border-2 border-dashed ${dropZoneClass}` }, userAnswer || 'یہاں ڈراپ کریں'), showAnswers && userAnswer !== correctAnswer && React.createElement("p", { className: "text-red-600 text-sm" }, correctAnswer)); })))))))));

        return React.createElement("div", { className: "bg-white/80 backdrop-blur-sm p-6 sm:p-8 rounded-2xl shadow-lg" },
          React.createElement("div", { className: "flex justify-between items-center mb-6" },
            React.createElement("h2", { className: "text-2xl sm:text-3xl font-bold text-blue-800" }, `ٹیسٹ: ${topic}`),
            React.createElement("button", { onClick: onExitQuizClick, className: "px-4 py-2 text-lg font-bold text-white bg-red-500 rounded-full hover:bg-red-600 shadow-md" }, "بند کریں")
          ),
          React.createElement("div", { className: "space-y-12" },
            renderMCQs(quiz.mcqs),
            renderFillInTheBlanks(quiz.fillInTheBlanks),
            renderShortAnswerQuestions(quiz.shortAnswerQuestions),
            renderDiagramLabeling(quiz.diagramLabeling),
            renderTableCompletion(quiz.tableCompletion)
          ),
          React.createElement("div", { className: "mt-8 pt-6 border-t-2 border-cyan-200 text-center" },
            React.createElement("button", { onClick: onShowAnswersClick, className: "px-8 py-4 text-xl font-bold text-white bg-gradient-to-r from-blue-600 to-cyan-600 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105" }, showAnswers ? 'اپنے جوابات چھپائیں' : 'جوابات چیک کریں')
          )
        );
      };

      // App.tsx
      function App() {
        const [selectedTopic, setSelectedTopic] = useState('');
        const [loading, setLoading] = useState(false);
        const [error, setError] = useState(null);
        const [result, setResult] = useState(null);
        const [quizData, setQuizData] = useState(null);
        const [isQuizActive, setIsQuizActive] = useState(false);
        const [quizLoading, setQuizLoading] = useState(false);
        const [showAnswers, setShowAnswers] = useState(false);

        const performGeneration = useCallback(async (generationFn) => {
          setLoading(true); setError(null); setResult(null); setIsQuizActive(false); setQuizData(null);
          try {
            const generatedResult = await generationFn();
            setResult(generatedResult);
          } catch (e) {
            const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred';
            setError(`ایک خرابی پیش آگئی: ${errorMessage}.`);
            console.error(e);
          } finally { setLoading(false); }
        }, []);

        const handleTopicSelect = useCallback((topic) => { setSelectedTopic(topic); performGeneration(() => generateScienceExplanation(topic)); }, [performGeneration]);
        const handleSearch = useCallback((topic) => { setSelectedTopic(topic); performGeneration(() => generateScienceExplanation(topic)); }, [performGeneration]);
        const handleSubTopicClick = useCallback((subTopic) => { setSelectedTopic(subTopic); performGeneration(() => generateScienceExplanation(subTopic)); }, [performGeneration]);
        const handleConvertPage = useCallback((file) => {
          setSelectedTopic('Uploaded Page');
          const reader = new FileReader();
          reader.readAsDataURL(file);
          reader.onload = () => {
            const base64String = (reader.result).split(',')[1];
            if (base64String) { performGeneration(() => generateContentFromPage(base64String, file.type)); }
            else { setError("Could not read the image file."); }
          };
          reader.onerror = () => setError("Error reading the image file.");
        }, [performGeneration]);

        const handleStartQuiz = useCallback(async (topic) => {
          setQuizLoading(true); setError(null);
          try {
            const quiz = await generateQuiz(topic);
            setQuizData(quiz);
            setShowAnswers(false); setIsQuizActive(true);
          } catch (e) {
            const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred';
            setError(`ٹیسٹ تیار کرنے میں ناکامی: ${errorMessage}.`);
            console.error(e);
          } finally { setQuizLoading(false); }
        }, []);

        const handleExitQuiz = () => { setIsQuizActive(false); setQuizData(null); };
        const handleShowAnswers = () => setShowAnswers(prev => !prev);

        return React.createElement("div", { className: "bg-cyan-50 min-h-screen font-sans text-gray-800 p-4 sm:p-6 md:p-8" },
          React.createElement("div", { className: "max-w-4xl mx-auto space-y-8" },
            React.createElement(Header, { onSearch: handleSearch }),
            isQuizActive && quizData ?
              React.createElement(QuizView, { quiz: quizData, topic: result?.title || selectedTopic, showAnswers: showAnswers, onShowAnswersClick: handleShowAnswers, onExitQuizClick: handleExitQuiz }) :
              React.createElement("main", null,
                React.createElement("section", { className: "bg-white/80 backdrop-blur-sm p-6 rounded-2xl shadow-lg space-y-6" },
                  React.createElement("h2", { className: "text-2xl font-bold text-cyan-800 text-center" }, "کتاب کے یونٹ میں سے ایک منتخب کریں"),
                  React.createElement(TopicSelector, { topics: SCIENCE_TOPICS, selectedTopic: selectedTopic, onSelect: handleTopicSelect })
                ),
                React.createElement("section", { className: "mt-8" },
                  React.createElement(PageUploader, { onConvert: handleConvertPage, loading: loading })
                ),
                React.createElement(ResultDisplay, { loading: loading, error: error, result: result, onSubTopicClick: handleSubTopicClick, onStartQuiz: handleStartQuiz, quizLoading: quizLoading })
              )
          )
        );
      }
      
      // index.tsx
      const rootElement = document.getElementById('root');
      if (!rootElement) throw new Error("Could not find root element");
      const root = ReactDOM.createRoot(rootElement);
      root.render(React.createElement(React.StrictMode, null, React.createElement(App, null)));

      // --- END OF INLINED CODE ---
    </script>
  </body>
</html>